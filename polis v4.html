<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contatore Partite</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png">
    <link rel="apple-touch-icon" sizes="48x48" href="/favicon-48x48.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        
        /* Anti-pull-to-refresh CSS - Previene il refresh accidentale causato dal gesto di pull-to-refresh */
        html, body {
            overscroll-behavior-y: contain; /* Previene il pull-to-refresh su Chrome/Android e Edge */
            -webkit-overflow-scrolling: touch; /* Migliora lo scrolling su iOS */
            height: 100%; /* Necessario per il contenimento del overscroll */
        }

        /* Ulteriori precauzioni per iOS/Safari - limita il comportamento di overscroll */
        body {
            position: fixed; /* Alternativa per iOS quando overscroll-behavior non è supportato */
            width: 100%;
            top: 0;
            left: 0;
            overflow-x: hidden;
            overflow-y: auto;
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #e2e8f0;
            padding: 1.5rem;
        }
        .container {
            background-color: #1e293b;
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            text-align: center;
            max-width: 900px;
            width: 100%;
        }
        .title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #f8fafc;
            margin-bottom: 2rem;
            text-align: left;
        }
        .date-display {
            text-align: right;
            font-size: 1rem;
            color: #94a3b8;
            margin-bottom: 0.5rem;
        }
        .score-display {
            font-size: 6.5rem;
            font-weight: 700;
            color: #f1f5f9;
            margin: 2rem 0;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
        }
        .score-digit {
            transition: transform 0.2s ease-in-out;
        }
        .score-digit:hover {
            transform: scale(1.1);
        }
        
        /* Animazione per l'effetto di ingrandimento del punteggio */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .score-digit.is-pulsing {
            animation: pulse 1s ease-in-out;
        }

        /* Nuova animazione per le statistiche */
        @keyframes stat-pulse {
            0% { transform: scale(1); color: #f1f5f9; }
            50% { transform: scale(1.1); color: #60a5fa; }
            100% { transform: scale(1); color: #f1f5f9; }
        }
        .stat-item span.is-pulsing-stat {
            animation: stat-pulse 0.5s ease-in-out;
        }

        /* Stili per i coriandoli */
        .confetti {
            position: absolute;
            z-index: 1000;
            animation: fall 5s forwards;
        }
        @keyframes fall {
            to {
                transform: translateY(100vh) rotateZ(360deg);
                opacity: 0;
            }
        }

        .teams-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        .team {
            background-color: #334155;
            padding: 1.5rem;
            border-radius: 1rem;
        }
        .team-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 1rem;
            /* Responsive team name fixes */
            word-break: break-word;
            hyphens: auto;
            overflow-wrap: break-word;
            text-align: center;
            /* Dynamic font sizing */
            font-size: clamp(1rem, 3.5vw, 1.875rem);
            line-height: 1.2;
        }
        .team-title[contenteditable="true"]:focus {
            outline: 2px solid #60a5fa;
            outline-offset: 4px;
        }

        /* Responsive team names above score display */
        .text-3xl {
            /* Fixes for responsive team names above score */
            word-break: break-word;
            hyphens: auto;
            overflow-wrap: break-word;
            max-width: 45%; /* Prevent overlapping with other team name */
            text-align: center;
            /* Dynamic font sizing */
            font-size: clamp(1rem, 4vw, 1.875rem) !important;
            line-height: 1.2 !important;
        }

        /* Nuovi stili per i bottoni */
        .btn {
            color: white;
            font-weight: 600;
            padding: 0.75rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            border: none;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
        }
        .btn:active {
            transform: scale(0.95);
        }
        .btn-goal {
            background: linear-gradient(to right, #22c55e, #16a34a);
            padding: 1.25rem 2.5rem; /* Rende i pulsanti più grandi */
        }
        .btn-stats-add {
            background: linear-gradient(to right, #f97316, #ea580c);
            padding: 1rem 1.5rem; /* Aumento la dimensione dei pulsanti stats */
        }
        .btn-yellow-card, .btn-red-card {
            background: transparent;
            border: none;
            padding: 0.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s ease-in-out;
            border-radius: 0.5rem;
        }
        .btn-yellow-card:hover, .btn-red-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
        }
        .btn-yellow-card img, .btn-red-card img {
            width: 40px;
            height: 40px;
            margin: 0;
        }
        .btn-remove-goal {
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            height: 3rem;
            width: 3rem;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .btn-remove-goal:hover {
            background-color: #dc2626;
        }
        .btn-remove-stats {
            background-color: #94a3b8;
            color: #4a5568;
            font-weight: 600;
            border-radius: 0.75rem;
            height: 3rem;
        }
        .btn-remove-stats:hover {
            background-color: #64748b;
            color: #f8fafc;
        }

        /* Stili per le statistiche */
        .stats-container {
            margin-top: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        .stats-team {
            background-color: #334155;
            padding: 1rem;
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            font-size: 1.25rem;
            font-weight: 600;
            color: #e2e8f0;
        }

        /* Nuovi stili per la griglia dei pulsanti */
        .button-grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        .button-section {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem;
        }
        
        /* Stili per i popup */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.is-active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: #1e293b;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.is-active .modal-content {
            transform: scale(1);
        }
        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
        }
        .player-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-height: 40vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 1.5rem;
        }
        .player-btn {
            background-color: #334155;
            color: white;
            padding: 0.75rem;
            border-radius: 0.75rem;
            transition: background-color 0.2s;
        }
        .player-btn:hover {
            background-color: #475569;
        }
        .player-btn:active {
            transform: scale(0.95);
        }
        
        /* Stili per la lista dei marcatori all'interno delle statistiche */
        .scorer-list {
            text-align: left;
            padding: 0.5rem 0 0 0;
            border-top: 1px solid #475569;
            margin-top: 1rem;
        }
        .scorer-list h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #a0aec0;
        }
        .scorer-list-item {
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
            color: #cbd5e1;
        }
        
        .cards-list {
            text-align: left;
            padding: 0.5rem 0 0 0;
            border-top: 1px solid #475569;
            margin-top: 1rem;
        }
        .cards-list h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #a0aec0;
        }
        .cards-list-item {
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
            color: #cbd5e1;
            display: flex;
            align-items: center;
        }
        .cards-list-item img {
            width: 16px;
            height: 16px;
            margin-right: 6px;
        }
        
        /* Stili per mobile (schermi più stretti di 640px) */
        @media (max-width: 640px) {
            .teams-container, .stats-container, .goal-list-container {
                grid-template-columns: 1fr;
                flex-direction: column;
            }
            .score-display {
                font-size: 4rem;
            }
            .button-grid-2 {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }
            .btn {
                font-size: 0.6rem;
                padding: 0.3rem;
            }
            .btn-goal {
                padding: 0.75rem 1rem; /* Nuovo padding per pulsanti più grandi su mobile */
            }
            .btn-stats-add {
                padding: 0.75rem 1rem; /* Nuovo padding per i pulsanti stats su mobile */
            }
            .btn-remove-goal {
                height: 2.5rem;
                width: 2.5rem;
            }
            .timer-display-container {
                flex-direction: column;
                gap: 0.5rem;
            }
            .team-title {
                font-size: 1.5rem;
                /* Mobile specific fixes for team names */
                font-size: clamp(0.9rem, 4vw, 1.5rem) !important;
            }
            
            /* Mobile specific fixes for team names above score */
            .text-3xl {
                font-size: clamp(0.8rem, 5vw, 1.5rem) !important;
                max-width: 42% !important; /* Slightly smaller on mobile */
            }
        }

        /* Stile per il pulsante di reset */
        .btn-reset {
            background-color: #dc2626;
            color: white;
            font-size: 1.25rem;
            font-weight: 700;
            padding: 1rem 2rem;
        }
        .btn-reset:hover {
            background-color: #ef4444;
        }

        /* Stile per il pulsante di condivisione */
        .btn-share {
            background: linear-gradient(to right, #8b5cf6, #7c3aed);
            color: white;
            font-size: 1.25rem;
            font-weight: 700;
            padding: 1rem 2rem;
        }
        .btn-share:hover {
            background: linear-gradient(to right, #7c3aed, #6d28d9);
        }

        /* Stile per il pulsante di storico (ora uguale a share e reset) */
        .btn-history {
            background: linear-gradient(to right, #f97316, #ea580c);
            color: white;
            font-size: 1.25rem;
            font-weight: 700;
            padding: 1rem 2rem;
        }
        .btn-history:hover {
            background: linear-gradient(to right, #ea580c, #c55d0a);
        }

        /* Stile specifico per il campo di input */
        .modal-input {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 2px solid #475569;
            background-color: #334155;
            color: #f1f5f9;
            text-align: center;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }
        .modal-input:focus {
            outline: none;
            border-color: #60a5fa;
        }
        /* Stile per lo storico */
        .history-list {
            list-style: none;
            padding: 0;
            text-align: left;
            max-height: 60vh;
            overflow-y: auto;
        }
        .history-item {
            background-color: #334155;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            text-align: center; /* Centra il contenuto degli elementi dello storico per una migliore leggibilità */
        }
        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .history-score-info {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }
        .history-date {
            font-size: 0.9rem;
            color: #94a3b8;
        }

        /* Stile per il pulsante di eliminazione */
        .delete-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 1.5rem;
            line-height: 1;
            padding: 0;
            margin-left: 1rem; /* Spazio per evitare sovrapposizioni */
        }
        .delete-btn:hover {
            color: #dc2626;
        }
        /* Stile per il pulsante "Cancella tutto" */
        .btn-clear-history {
            background-color: #dc2626;
            color: white;
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            margin-top: 1rem;
        }
        
        /* Stili per il timer */
        .timer-container {
            background-color: #334155;
            padding: 1rem;
            border-radius: 1rem;
            margin-bottom: 2rem;
        }
        .timer-display-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        #timer-display {
            font-size: 3rem;
            font-weight: 700;
            color: #f1f5f9;
            cursor: pointer;
            transition: color 0.2s ease-in-out;
        }
        #timer-display:hover {
            color: #60a5fa;
        }
        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 0.75rem;
        }
        .btn-start { background-color: #10b981; }
        .btn-start:hover { background-color: #059669; }
        .btn-pause { background-color: #f59e0b; }
        .btn-pause:hover { background-color: #d97706; }
        .btn-reset-timer { background-color: #ef4444; }
        .btn-reset-timer:hover { background-color: #dc2626; }

        /* Animazione per il timer */
        @keyframes timer-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .timer-running {
            animation: timer-pulse 1s ease-in-out infinite;
        }

        /* Stili per la sezione di condivisione (immagine) */
        .share-container {
            background-color: #334155;
            padding: 2rem;
            border-radius: 1.5rem;
            margin-top: 2rem;
            display: none; /* Inizialmente nascosto */
            animation: fadeIn 0.5s ease-out forwards;
            position: relative;
        }
        .share-container.is-visible {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .share-summary {
            background-color: #1e293b;
            padding: 1.5rem;
            border-radius: 1rem;
            text-align: left;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        .share-score {
            font-size: 2.5rem;
            font-weight: 800;
            text-align: center;
            margin: 1rem 0;
            color: #f1f5f9;
        }
        .share-stat-item {
            display: flex;
            justify-content: space-between;
            font-size: 1rem;
            font-weight: 600;
            color: #cbd5e1;
        }
        .share-scorers {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #475569;
        }
        .share-scorers h4 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        .image-preview {
            max-width: 100%;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            margin-top: 1.5rem;
            border: 2px solid #60a5fa;
        }
        
        /* Stili per il popup dello storico aggiornato */
        .history-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .history-section {
            background-color: #2b384a;
            padding: 1rem;
            border-radius: 0.75rem;
        }
        .history-section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #f1f5f9;
        }
        .scorers-table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }
        
        /* Stili per centrare il contenuto dello storico partite (vinte/perse/pareggiate) */
        .scorers-table th, .scorers-table td {
            text-align: center; /* Centra il contenuto delle celle per migliorare l'allineamento */
        }
        
        /* Centra le statistiche delle partite nella sezione storico */
        .history-section {
            text-align: center; /* Centra il contenuto della sezione storico */
        }
        
        .scorers-table th, .scorers-table td {
            padding: 0.75rem;
            border-bottom: 1px solid #475569;
        }
        .scorers-table th {
            color: #94a3b8;
            font-weight: 600;
        }
        .scorers-table tbody tr:last-child td {
            border-bottom: none;
        }
        .scorers-table tr:hover {
            background-color: #334155;
        }
    </style>
</head>
<body>

<!-- Popup iniziale per il nome della squadra -->
<div id="initial-setup-modal" class="modal-overlay is-active">
    <div class="modal-content">
        <div class="modal-header">Nome Squadra 2</div>
        <input type="text" id="team-name-input" class="modal-input" placeholder="Inserisci il nome">
        <p class="text-gray-400 mb-6">Mi raccomando, compila tutto con cura!</p>
        <button id="start-game-button" class="btn btn-goal px-8">Inizia Partita</button>
    </div>
</div>

<div class="container" id="main-content-to-capture">
    <p id="current-date" class="date-display"></p>
    <h1 class="title">POLIS 2013</h1>
    
    <!-- Sezione Timer -->
    <div class="timer-container">
        <div class="timer-display-container">
            <span id="timer-display">20:00</span>
            <span id="recovery-display" style="font-size: 1.5rem; color: #fbbf24; margin-left: 1rem; display: none;">Recupero: 0:00</span>
        </div>
        <div class="timer-controls">
            <button id="start-timer-button" class="btn btn-start">Avvia</button>
            <button id="pause-timer-button" class="btn btn-pause">Pausa</button>
            <button id="reset-timer-button" class="btn btn-reset-timer">Reset</button>
        </div>
    </div>
    
    <!-- Nomi delle squadre sopra il punteggio -->
    <div class="flex justify-between items-end mb-2">
        <h2 class="text-3xl font-bold text-gray-200">POLIS</h2>
        <h2 id="score-team2-name" class="text-3xl font-bold text-gray-200">Squadra 2</h2>
    </div>

    <div class="score-display">
        <span id="score-team1" class="score-digit">0</span>
        <span>-</span>
        <span id="score-team2" class="score-digit">0</span>
    </div>

    <div class="teams-container">
        <!-- Squadra 1 -->
        <div class="team">
            <h2 class="team-title">POLIS</h2>
            <!-- First row: Gol and Tiro side by side -->
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div class="flex flex-col items-center">
                    <button class="btn btn-goal" data-team="1" data-type="goal" data-action="add">Gol</button>
                    <button class="btn btn-remove-goal mt-2" data-team="1" data-type="goal" data-action="remove">-</button>
                </div>
                <div class="flex flex-col items-center">
                    <button class="btn btn-stats-add" data-team="1" data-type="shot" data-action="add">Tiro</button>
                    <button class="btn btn-remove-stats mt-2" data-team="1" data-type="shot" data-action="remove">-</button>
                </div>
            </div>
            <!-- Second row: Corner and Fallo side by side -->
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div class="flex flex-col items-center">
                    <button class="btn btn-stats-add" data-team="1" data-type="corner" data-action="add">Corner</button>
                    <button class="btn btn-remove-stats mt-2" data-team="1" data-type="corner" data-action="remove">-</button>
                </div>
                <div class="flex flex-col items-center">
                    <button class="btn btn-stats-add" data-team="1" data-type="foul" data-action="add">Fallo</button>
                    <button class="btn btn-remove-stats mt-2" data-team="1" data-type="foul" data-action="remove">-</button>
                </div>
            </div>
            <!-- Third row: Yellow and Red cards side by side -->
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div class="flex flex-col items-center">
                    <button class="btn btn-yellow-card" data-team="1" data-type="yellow-card" data-action="add">
                        <img src="icons8-cartellino-giallo-calcio-96.png" alt="Cartellino Giallo">
                    </button>
                    <button class="btn btn-remove-stats mt-2" data-team="1" data-type="yellow-card" data-action="remove">-</button>
                </div>
                <div class="flex flex-col items-center">
                    <button class="btn btn-red-card" data-team="1" data-type="red-card" data-action="add">
                        <img src="icons8-cartellino-rosso-calcio-96 (1).png" alt="Cartellino Rosso">
                    </button>
                    <button class="btn btn-remove-stats mt-2" data-team="1" data-type="red-card" data-action="remove">-</button>
                </div>
            </div>
        </div>

        <!-- Squadra 2 -->
        <div class="team">
            <h2 id="team2-name" class="team-title">Squadra 2</h2>
            <!-- First row: Gol and Tiro side by side -->
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div class="flex flex-col items-center">
                    <button class="btn btn-goal" data-team="2" data-type="goal" data-action="add">Gol</button>
                    <button class="btn btn-remove-goal mt-2" data-team="2" data-type="goal" data-action="remove">-</button>
                </div>
                <div class="flex flex-col items-center">
                    <button class="btn btn-stats-add" data-team="2" data-type="shot" data-action="add">Tiro</button>
                    <button class="btn btn-remove-stats mt-2" data-team="2" data-type="shot" data-action="remove">-</button>
                </div>
            </div>
            <!-- Second row: Corner and Fallo side by side -->
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div class="flex flex-col items-center">
                    <button class="btn btn-stats-add" data-team="2" data-type="corner" data-action="add">Corner</button>
                    <button class="btn btn-remove-stats mt-2" data-team="2" data-type="corner" data-action="remove">-</button>
                </div>
                <div class="flex flex-col items-center">
                    <button class="btn btn-stats-add" data-team="2" data-type="foul" data-action="add">Fallo</button>
                    <button class="btn btn-remove-stats mt-2" data-team="2" data-type="foul" data-action="remove">-</button>
                </div>
            </div>
            <!-- Third row: Yellow and Red cards side by side -->
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div class="flex flex-col items-center">
                    <button class="btn btn-yellow-card" data-team="2" data-type="yellow-card" data-action="add">
                        <img src="icons8-cartellino-giallo-calcio-96.png" alt="Cartellino Giallo">
                    </button>
                    <button class="btn btn-remove-stats mt-2" data-team="2" data-type="yellow-card" data-action="remove">-</button>
                </div>
                <div class="flex flex-col items-center">
                    <button class="btn btn-red-card" data-team="2" data-type="red-card" data-action="add">
                        <img src="icons8-cartellino-rosso-calcio-96 (1).png" alt="Cartellino Rosso">
                    </button>
                    <button class="btn btn-remove-stats mt-2" data-team="2" data-type="red-card" data-action="remove">-</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sezione Statistiche -->
    <div class="stats-container">
        <!-- Statistiche Squadra 1 -->
        <div class="stats-team">
            <h3 class="team-title">Statistiche POLIS</h3>
            <div class="stat-item">
                <span>Gol fatti:</span>
                <span id="goals-team1">0</span>
            </div>
            <div class="stat-item">
                <span>Gol subiti:</span>
                <span id="goals-team2-taken">0</span>
            </div>
            <div class="stat-item">
                <span>Tiri fatti:</span>
                <span id="shots-team1">0</span>
            </div>
            <div class="stat-item">
                <span>Tiri subiti:</span>
                <span id="shots-team2-taken">0</span>
            </div>
            <div class="stat-item">
                <span>Corner fatti:</span>
                <span id="corners-team1">0</span>
            </div>
            <div class="stat-item">
                <span>Corner subiti:</span>
                <span id="corners-team2-taken">0</span>
            </div>
            <div class="stat-item">
                <span>Falli fatti:</span>
                <span id="fouls-team1">0</span>
            </div>
            <div class="stat-item">
                <span>Falli subiti:</span>
                <span id="fouls-team2-taken">0</span>
            </div>
            <div class="stat-item">
                <span>Cartellini gialli:</span>
                <span id="yellow-cards-team1">0</span>
            </div>
            <div class="stat-item">
                <span>Cartellini rossi:</span>
                <span id="red-cards-team1">0</span>
            </div>
            <div id="scorers-list-1" class="scorer-list">
                <h4>Marcatori:</h4>
                <!-- I marcatori verranno aggiunti qui -->
            </div>
            <div id="cards-list-1" class="cards-list">
                <h4>Cartellini:</h4>
                <!-- I cartellini verranno aggiunti qui -->
            </div>
        </div>

        <!-- Statistiche Squadra 2 -->
        <div class="stats-team">
            <h3 class="team-title" id="stats-team2-title">Statistiche Squadra 2</h3>
            <div class="stat-item">
                <span>Gol fatti:</span>
                <span id="goals-team2">0</span>
            </div>
            <div class="stat-item">
                <span>Gol subiti:</span>
                <span id="goals-team1-taken">0</span>
            </div>
            <div class="stat-item">
                <span>Tiri fatti:</span>
                <span id="shots-team2">0</span>
            </div>
            <div class="stat-item">
                <span>Tiri subiti:</span>
                <span id="shots-team1-taken">0</span>
            </div>
            <div class="stat-item">
                <span>Corner fatti:</span>
                <span id="corners-team2">0</span>
            </div>
            <div class="stat-item">
                <span>Corner subiti:</span>
                <span id="corners-team1-taken">0</span>
            </div>
            <div class="stat-item">
                <span>Falli fatti:</span>
                <span id="fouls-team2">0</span>
            </div>
            <div class="stat-item">
                <span>Falli subiti:</span>
                <span id="fouls-team1-taken">0</span>
            </div>
            <div class="stat-item">
                <span>Cartellini gialli:</span>
                <span id="yellow-cards-team2">0</span>
            </div>
            <div class="stat-item">
                <span>Cartellini rossi:</span>
                <span id="red-cards-team2">0</span>
            </div>
            <div id="scorers-list-2" class="scorer-list">
                <h4>Marcatori:</h4>
                <!-- I marcatori verranno aggiunti qui -->
            </div>
            <div id="cards-list-2" class="cards-list">
                <h4>Cartellini:</h4>
                <!-- I cartellini verranno aggiunti qui -->
            </div>
        </div>
    </div>
    
    <!-- Sezione Note -->
    <div class="notes-container mt-6">
        <h3 class="text-lg font-semibold mb-3 text-center text-white">Note Partita</h3>
        <textarea 
            id="match-notes" 
            placeholder="Inserisci qui le note della partita..." 
            class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white resize-none focus:outline-none focus:border-blue-400"
            rows="3"
        ></textarea>
    </div>
    
    <!-- Pulsanti di azione a livello di pagina -->
    <div class="flex justify-center items-center mt-8 gap-4 flex-wrap">
        <button id="reset-button" class="btn btn-reset flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
            RESET
        </button>
        <button id="save-share-button" class="btn btn-share flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.88 15.114 9 17 9 17a3 3 0 100-6 3 3 0 000 6zM20.242 6.342a3 3 0 10-3.864 3.864M12 21a9 9 0 100-18 9 9 0 000 18z" />
            </svg>
            SALVA E CONDIVIDI
        </button>
        <button id="show-history-button" class="btn btn-history flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 112 2m0-2a2 2 10-2 2m0 0a2 2 112 2m0-2a2 2 10-2 2m0 0a2 2 112 2m0-2a2 2 10-2 2m0 0a2 2 112 2m0-2a2 2 10-2 2m0 0a2 2 112 2m0-2a2 2 10-2 2" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0 0v6m0 0v6m0 0v6m0 0v6m0 0v6m0 0v6m0 0v6m0 0v6" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 12a2 2 0 11-4 0 2 2 0 014 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 12v.01" />
            </svg>
            VISUALIZZA STORICO
        </button>
    </div>
</div>

<!-- Sezione per la condivisione, inizialmente nascosta -->
<div id="share-section" class="share-container">
    <div id="share-content-to-capture">
        <h2 class="text-xl font-bold mb-4">Riepilogo Partita</h2>
        <div class="share-summary">
            <div id="share-summary-content">
                <!-- Il contenuto verrà generato da JavaScript -->
            </div>
        </div>
    </div>
    <img id="screenshot-preview" class="image-preview hidden">
    <div class="flex justify-center mt-6 gap-4">
        <a id="download-link" href="#" class="btn btn-share w-full" download="riepilogo-partita.png">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            Scarica Immagine
        </a>
        <button id="close-share-button" class="btn bg-gray-500 hover:bg-gray-600 w-full">Chiudi</button>
    </div>
</div>

<!-- Popup per la selezione del giocatore -->
<div id="player-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">Chi ha segnato?</div>
        <div id="player-list" class="player-list">
            <!-- I pulsanti dei giocatori verranno aggiunti qui via JavaScript -->
        </div>
        <button id="cancel-player-selection-button" class="btn bg-gray-500 hover:bg-gray-600 px-8">Annulla</button>
    </div>
</div>

<!-- Popup di conferma generale per la rimozione -->
<div id="remove-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header" id="remove-modal-header"></div>
        <p class="text-gray-400 mb-6" id="remove-modal-message"></p>
        <div class="flex justify-center gap-4">
            <button id="confirm-remove-button" class="btn btn-reset px-8">Sì, Rimuovi</button>
            <button id="cancel-remove-button" class="btn bg-gray-500 hover:bg-gray-600 px-8">Annulla</button>
        </div>
    </div>
</div>

<!-- Popup di conferma reset -->
<div id="reset-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">Sei sicuro di voler resettare?</div>
        <p class="text-gray-400 mb-6">Tutti i dati della partita andranno persi.</p>
        <div class="flex justify-center gap-4">
            <button id="confirm-reset-button" class="btn btn-reset px-8">Sì, Reset</button>
            <button id="cancel-reset-button" class="btn bg-gray-500 hover:bg-gray-600 px-8">Annulla</button>
        </div>
    </div>
</div>

<!-- Popup per lo storico delle partite -->
<div id="history-modal" class="modal-overlay">
    <div class="modal-content max-w-lg">
        <div class="modal-header">Storico Partite e Statistiche</div>
        <div class="history-content">
            <!-- Sezione Riepilogo Statistiche Totali -->
            <div class="history-section">
                <div>
                    <span>Partite giocate totali: <span id="total-matches-played">0</span></span>
                </div>
                
                <!-- Tabella Risultati Partite -->
                <table class="scorers-table" style="margin-top: 1rem;">
                    <thead>
                        <tr>
                            <th>Vinte</th>
                            <th>Perse</th>
                            <th>Pareggiate</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td id="total-matches-won">0</td>
                            <td id="total-matches-lost">0</td>
                            <td id="total-matches-drawn">0</td>
                        </tr>
                    </tbody>
                </table>
                
                <!-- Tabella Statistiche Totali -->
                <table class="scorers-table" style="margin-top: 1rem;">
                    <thead>
                        <tr>
                            <th>Statistica</th>
                            <th>Fatti</th>
                            <th>Subiti</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Gol</td>
                            <td id="total-goals-made">0</td>
                            <td id="total-goals-conceded">0</td>
                        </tr>
                        <tr>
                            <td>Tiri</td>
                            <td id="total-shots-made">0</td>
                            <td id="total-shots-conceded">0</td>
                        </tr>
                        <tr>
                            <td>Corner</td>
                            <td id="total-corners-made">0</td>
                            <td id="total-corners-conceded">0</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Sezione Classifica Marcatori -->
            <div class="history-section">
                <h3 class="history-section-title">Classifica Marcatori POLIS</h3>
                <table class="scorers-table">
                    <thead>
                        <tr>
                            <th>Pos.</th>
                            <th>Giocatore</th>
                            <th>Gol</th>
                        </tr>
                    </thead>
                    <tbody id="scorers-table-body">
                        <!-- La tabella verrà popolata da JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Sezione Storico Partite -->
            <div class="history-section">
                <h3 class="history-section-title">Partite Giocate</h3>
                <ul id="history-list" class="history-list">
                    <!-- Gli elementi dello storico verranno aggiunti qui -->
                </ul>
                <div class="flex justify-center mt-4">
                    <button id="clear-history-button" class="btn btn-clear-history">Cancella tutto</button>
                </div>
            </div>
        </div>
        <button id="close-history-button" class="btn btn-goal mt-4 px-8">Chiudi</button>
    </div>
</div>

<!-- Popup di conferma per l'eliminazione singola dallo storico -->
<div id="delete-history-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">Conferma Eliminazione</div>
        <p class="text-gray-400 mb-6">Sei sicuro di voler eliminare questa partita dallo storico?</p>
        <div class="flex justify-center gap-4">
            <button id="confirm-delete-history-button" class="btn btn-reset px-8">Sì, Elimina</button>
            <button id="cancel-delete-history-button" class="btn bg-gray-500 hover:bg-gray-600 px-8">Annulla</button>
        </div>
    </div>
</div>

<!-- Popup di conferma per l'eliminazione di tutto lo storico -->
<div id="clear-history-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">Conferma Eliminazione Completa</div>
        <p class="text-gray-400 mb-6">Sei sicuro di voler eliminare TUTTE le partite dallo storico?</p>
        <div class="flex justify-center gap-4">
            <button id="confirm-clear-history-button" class="btn btn-reset px-8">Sì, Cancella Tutto</button>
            <button id="cancel-clear-history-button" class="btn bg-gray-500 hover:bg-gray-600 px-8">Annulla</button>
        </div>
    </div>
</div>

<!-- Nuovo popup per impostare il timer -->
<div id="timer-setup-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">Imposta il tempo</div>
        <div class="flex justify-center gap-2 mb-4">
            <input type="number" id="timer-minutes-input" class="modal-input w-20" value="20" min="0" max="99">
            <span class="text-xl font-bold">:</span>
            <input type="number" id="timer-seconds-input" class="modal-input w-20" value="0" min="0" max="59">
        </div>
        <p class="text-gray-400 mb-6">Minuti e Secondi</p>
        <button id="set-timer-button" class="btn btn-goal px-8">Imposta</button>
    </div>
</div>

<script>
    // Seleziona gli elementi della pagina
    const scoreTeam1Display = document.getElementById('score-team1');
    const scoreTeam2Display = document.getElementById('score-team2');
    const scoreTeam2NameDisplay = document.getElementById('score-team2-name');
    const actionButtons = document.querySelectorAll('.btn');
    const team2NameElement = document.getElementById('team2-name');
    const dateDisplay = document.getElementById('current-date');
    const statsTeam2Title = document.getElementById('stats-team2-title');

    const goalsTeam1Display = document.getElementById('goals-team1');
    const shotsTeam1Display = document.getElementById('shots-team1');
    const cornersTeam1Display = document.getElementById('corners-team1');
    const foulsTeam1Display = document.getElementById('fouls-team1');
    const yellowCardsTeam1Display = document.getElementById('yellow-cards-team1');
    const redCardsTeam1Display = document.getElementById('red-cards-team1');
    const goalsTeam2TakenDisplay = document.getElementById('goals-team2-taken');
    const shotsTeam2TakenDisplay = document.getElementById('shots-team2-taken');
    const cornersTeam2TakenDisplay = document.getElementById('corners-team2-taken');
    const foulsTeam2TakenDisplay = document.getElementById('fouls-team2-taken');
    const yellowCardsTeam2TakenDisplay = document.getElementById('yellow-cards-team2-taken');
    const redCardsTeam2TakenDisplay = document.getElementById('red-cards-team2-taken');
    
    const goalsTeam2Display = document.getElementById('goals-team2');
    const shotsTeam2Display = document.getElementById('shots-team2');
    const cornersTeam2Display = document.getElementById('corners-team2');
    const foulsTeam2Display = document.getElementById('fouls-team2');
    const yellowCardsTeam2Display = document.getElementById('yellow-cards-team2');
    const redCardsTeam2Display = document.getElementById('red-cards-team2');
    const goalsTeam1TakenDisplay = document.getElementById('goals-team1-taken');
    const shotsTeam1TakenDisplay = document.getElementById('shots-team1-taken');
    const cornersTeam1TakenDisplay = document.getElementById('corners-team1-taken');
    const foulsTeam1TakenDisplay = document.getElementById('fouls-team1-taken');
    const yellowCardsTeam1TakenDisplay = document.getElementById('yellow-cards-team1-taken');
    const redCardsTeam1TakenDisplay = document.getElementById('red-cards-team1-taken');


    const scorersList1 = document.getElementById('scorers-list-1');
    const scorersList2 = document.getElementById('scorers-list-2');
    
    const resetButton = document.getElementById('reset-button');
    const saveShareButton = document.getElementById('save-share-button');
    const showHistoryButton = document.getElementById('show-history-button');
    
    const shareSection = document.getElementById('share-section');
    const shareContentToCapture = document.getElementById('share-content-to-capture');
    const screenshotPreview = document.getElementById('screenshot-preview');
    const downloadLink = document.getElementById('download-link');
    const closeShareButton = document.getElementById('close-share-button');
    
    // Elementi del popup iniziale
    const initialSetupModal = document.getElementById('initial-setup-modal');
    const teamNameInput = document.getElementById('team-name-input');
    const startGameButton = document.getElementById('start-game-button');

    // Elementi del popup dei giocatori
    const playerModal = document.getElementById('player-modal');
    const playerListContainer = document.getElementById('player-list');
    const cancelPlayerSelectionButton = document.getElementById('cancel-player-selection-button');

    // Elementi del popup di conferma rimozione
    const removeModal = document.getElementById('remove-modal');
    const removeModalHeader = document.getElementById('remove-modal-header');
    const removeModalMessage = document.getElementById('remove-modal-message');
    const confirmRemoveButton = document.getElementById('confirm-remove-button');
    const cancelRemoveButton = document.getElementById('cancel-remove-button');

    // Elementi del popup di conferma reset
    const resetModal = document.getElementById('reset-modal');
    const confirmResetButton = document.getElementById('confirm-reset-button');
    const cancelResetButton = document.getElementById('cancel-reset-button');

    // Elementi del popup storico
    const historyModal = document.getElementById('history-modal');
    const historyList = document.getElementById('history-list');
    const scorersTableBody = document.getElementById('scorers-table-body');
    const closeHistoryButton = document.getElementById('close-history-button');
    
    // Nuovi elementi per l'eliminazione dallo storico
    const deleteHistoryModal = document.getElementById('delete-history-modal');
    const confirmDeleteHistoryButton = document.getElementById('confirm-delete-history-button');
    const cancelDeleteHistoryButton = document.getElementById('cancel-delete-history-button');
    const clearHistoryModal = document.getElementById('clear-history-modal');
    const confirmClearHistoryButton = document.getElementById('confirm-clear-history-button');
    const cancelClearHistoryButton = document.getElementById('cancel-clear-history-button');
    const clearHistoryButton = document.getElementById('clear-history-button');

    // Nuovi elementi per il timer
    const timerDisplay = document.getElementById('timer-display');
    const recoveryDisplay = document.getElementById('recovery-display');
    const startTimerButton = document.getElementById('start-timer-button');
    const pauseTimerButton = document.getElementById('pause-timer-button');
    const resetTimerButton = document.getElementById('reset-timer-button');
    const timerSetupModal = document.getElementById('timer-setup-modal');
    const timerMinutesInput = document.getElementById('timer-minutes-input');
    const timerSecondsInput = document.getElementById('timer-seconds-input');
    const setTimerButton = document.getElementById('set-timer-button');
    
    // Dati del gioco
    let scoreTeam1 = 0;
    let scoreTeam2 = 0;
    let shotsTeam1 = 0;
    let cornersTeam1 = 0;
    let foulsTeam1 = 0;
    let yellowCardsTeam1 = 0;
    let redCardsTeam1 = 0;
    let shotsTeam2 = 0;
    let cornersTeam2 = 0;
    let foulsTeam2 = 0;
    let yellowCardsTeam2 = 0;
    let redCardsTeam2 = 0;
    
    // Lista dei marcatori e dei quarti in cui hanno segnato
    let team1Scorers = [];
    let team2Scorers = [];
    let team1Cards = []; // Array for team1 yellow and red cards with player details
    let team2Cards = []; // Array for team2 yellow and red cards with player details
    
    let pendingRemovalAction = null;
    let matchHistory = [];
    let pendingDeletionIndex = null; // Indice della partita da eliminare

    // Dati del timer
    let totalSeconds = 20 * 60;
    let timerInterval = null;
    let isRunning = false;
    let lastSetSeconds = 20 * 60;
    let recoverySeconds = 0; // Secondi di recupero
    let isInRecovery = false; // Indica se siamo nel tempo di recupero

    // Audio preloading per fischio.mp3
    let fischioAudio;

    // Lista dei giocatori
    const players = [
        "aaaALPA", "BECCARIS", "KEVIN", "BERLUSCONI", "BERNUCCI", "BOERO", "BRIANO", "CABASSI", "CALLIKU", "CAZZULO", "CONGIU", "DHAOUI", "DI DATO", "DONALD", "ESPOSITO", "GARDELLA", "GENNARO", "GIOIA", "KHAY", "LAMKHAYAR", "LANNA", "MARCHESE", "MELLO", "MELLUSO", "MONTEFIORI", "ODAGLIA", "PELLICCI", "PIGA", "PINASCO", "POLLIO", "SCALA", "STANCHI", "TONINI"
    ];

    // Funzione per impostare la data corrente
    function setDate() {
        const today = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        dateDisplay.textContent = today.toLocaleDateString('it-IT', options);
    }
    
    // Funzione per aggiornare i punteggi visualizzati
    function updateScores() {
        scoreTeam1Display.textContent = scoreTeam1;
        scoreTeam2Display.textContent = scoreTeam2;
        updateStats(); // Chiamata per sincronizzare le statistiche
    }

    // Funzione per aggiornare le statistiche visualizzate
    function updateStats() {
        // Aggiorna le statistiche della squadra 1
        goalsTeam1Display.textContent = scoreTeam1;
        goalsTeam2TakenDisplay.textContent = scoreTeam2;
        shotsTeam1Display.textContent = shotsTeam1;
        shotsTeam2TakenDisplay.textContent = shotsTeam2;
        cornersTeam1Display.textContent = cornersTeam1;
        cornersTeam2TakenDisplay.textContent = cornersTeam2;
        if (foulsTeam1Display) foulsTeam1Display.textContent = foulsTeam1;
        if (foulsTeam2TakenDisplay) foulsTeam2TakenDisplay.textContent = foulsTeam2;
        if (yellowCardsTeam1Display) yellowCardsTeam1Display.textContent = yellowCardsTeam1;
        if (yellowCardsTeam2TakenDisplay) yellowCardsTeam2TakenDisplay.textContent = yellowCardsTeam2;
        if (redCardsTeam1Display) redCardsTeam1Display.textContent = redCardsTeam1;
        if (redCardsTeam2TakenDisplay) redCardsTeam2TakenDisplay.textContent = redCardsTeam2;
    
        // Aggiorna le statistiche della squadra 2
        goalsTeam2Display.textContent = scoreTeam2;
        goalsTeam1TakenDisplay.textContent = scoreTeam1;
        shotsTeam2Display.textContent = shotsTeam2;
        shotsTeam1TakenDisplay.textContent = shotsTeam1;
        cornersTeam2Display.textContent = cornersTeam2;
        cornersTeam1TakenDisplay.textContent = cornersTeam1;
        if (foulsTeam2Display) foulsTeam2Display.textContent = foulsTeam2;
        if (foulsTeam1TakenDisplay) foulsTeam1TakenDisplay.textContent = foulsTeam1;
        if (yellowCardsTeam2Display) yellowCardsTeam2Display.textContent = yellowCardsTeam2;
        if (yellowCardsTeam1TakenDisplay) yellowCardsTeam1TakenDisplay.textContent = yellowCardsTeam1;
        if (redCardsTeam2Display) redCardsTeam2Display.textContent = redCardsTeam2;
        if (redCardsTeam1TakenDisplay) redCardsTeam1TakenDisplay.textContent = redCardsTeam1;
    }

    // Funzione per far vibrare il dispositivo
    function vibratePhone() {
        if ("vibrate" in navigator) {
            navigator.vibrate(200); // Vibra per 200ms
        }
    }

    // Funzione per riprodurre un suono alla fine del timer
    function playTimerSound() {
        try {
            if (fischioAudio) {
                fischioAudio.currentTime = 0;
                fischioAudio.play().catch(err => {
                    console.error('Audio playback failed, trying fallback:', err);
                    const fallback = new Audio('./fischio.mp3');
                    fallback.play().catch(err2 => {
                        console.error('Audio playback failed:', err2);
                    });
                });
            } else {
                const fallback = new Audio('./fischio.mp3');
                fallback.play().catch(err => {
                    console.error('Audio playback failed:', err);
                });
            }
        } catch (e) {
            console.error('Unable to play fischio.mp3', e);
        }
    }

    // Funzione per creare i coriandoli
    function createConfetti() {
        const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722'];
        const confettiCount = 50;

        for (let i = 0; i < confettiCount; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.width = `${Math.random() * 10 + 5}px`;
            confetti.style.height = `${Math.random() * 10 + 5}px`;
            confetti.style.left = `${Math.random() * 100}vw`;
            confetti.style.top = `${Math.random() * -20}vh`; // Inizia sopra lo schermo
            confetti.style.animationDuration = `${Math.random() * 2 + 3}s`;
            confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
            document.body.appendChild(confetti);

            setTimeout(() => {
                confetti.remove();
            }, parseFloat(confetti.style.animationDuration) * 1000);
        }
    }
    
    // Funzione per mostrare il popup dei giocatori
    function showPlayerModal(quarter) {
        playerListContainer.innerHTML = '';
        players.forEach(player => {
            const playerButton = document.createElement('button');
            playerButton.textContent = player;
            playerButton.classList.add('player-btn');
            playerButton.addEventListener('click', () => {
                vibratePhone();
                addGoalTeam1(player, quarter);
                hidePlayerModal();
            });
            playerListContainer.appendChild(playerButton);
        });
        playerModal.classList.add('is-active');
    }
    
    // Funzione per nascondere il popup dei giocatori
    function hidePlayerModal() {
        playerModal.classList.remove('is-active');
    }

    // Funzione per mostrare il popup di conferma rimozione
    function showRemoveModal(type, team) {
        let text = '';
        if (type === 'goal') {
            text = 'un goal';
        } else if (type === 'corner') {
            text = 'un corner';
        } else if (type === 'shot') {
            text = 'un tiro';
        } else if (type === 'foul') {
            text = 'un fallo';
        } else if (type === 'yellow-card') {
            text = 'un cartellino giallo';
        } else if (type === 'red-card') {
            text = 'un cartellino rosso';
        }
        removeModalHeader.textContent = `Sei sicuro di voler rimuovere ${text}?`;
        removeModalMessage.textContent = `Verrà rimosso l'ultimo ${text} segnato dalla squadra ${team}.`;
        pendingRemovalAction = { type, team };
        removeModal.classList.add('is-active');
    }
    
    // Funzione per nascondere il popup di conferma rimozione
    function hideRemoveModal() {
        removeModal.classList.remove('is-active');
    }
    
    // Funzione per mostrare il popup di conferma reset
    function showResetModal() {
        resetModal.classList.add('is-active');
    }

    // Funzione per nascondere il popup di conferma reset
    function hideResetModal() {
        resetModal.classList.remove('is-active');
    }

    // Funzione per mostrare il popup dello storico
    function showHistoryModal() {
        renderHistory();
        historyModal.classList.add('is-active');
    }

    // Funzione per nascondere il popup dello storico
    function hideHistoryModal() {
        historyModal.classList.remove('is-active');
    }

    // Funzione per mostrare il popup di conferma eliminazione singola
    function showDeleteHistoryModal(index) {
        pendingDeletionIndex = index;
        deleteHistoryModal.classList.add('is-active');
    }
    
    // Funzione per nascondere il popup di conferma eliminazione singola
    function hideDeleteHistoryModal() {
        deleteHistoryModal.classList.remove('is-active');
        pendingDeletionIndex = null;
    }

    // Funzione per mostrare il popup di conferma eliminazione completa
    function showClearHistoryModal() {
        clearHistoryModal.classList.add('is-active');
    }

    // Funzione per nascondere il popup di conferma eliminazione completa
    function hideClearHistoryModal() {
        clearHistoryModal.classList.remove('is-active');
    }

    // Funzione per aggiungere un goal per la squadra 1
    function addGoalTeam1(player, quarter) {
        scoreTeam1++;
        const newScorer = document.createElement('div');
        newScorer.classList.add('scorer-list-item');
        newScorer.textContent = `${player} (${quarter})`;
        scorersList1.appendChild(newScorer);
        team1Scorers.push({ player: player, quarter: quarter });

        scoreTeam1Display.classList.add('is-pulsing');
        setTimeout(() => {
            scoreTeam1Display.classList.remove('is-pulsing');
        }, 1000);
        createConfetti();
        updateScores();
        vibratePhone();
    }

    // Funzione per aggiungere un goal per la squadra 2
    function addGoalTeam2(quarter) {
        scoreTeam2++;
        const newScorer = document.createElement('div');
        newScorer.classList.add('scorer-list-item');
        newScorer.textContent = `Goal (${quarter})`;
        scorersList2.appendChild(newScorer);
        team2Scorers.push({ player: 'Sconosciuto', quarter: quarter });
        updateScores();
    }
    
    // Card player modal functions
    function showCardPlayerModal(cardType) {
        playerListContainer.innerHTML = '';
        players.forEach(player => {
            const playerButton = document.createElement('button');
            playerButton.textContent = player;
            playerButton.classList.add('player-btn');
            playerButton.addEventListener('click', () => {
                vibratePhone();
                addCardTeam1(player, cardType);
                hidePlayerModal();
            });
            playerListContainer.appendChild(playerButton);
        });
        playerModal.classList.add('is-active');
    }

    // Card functions
    function addCardTeam1(player, cardType) {
        const cardData = {
            player: player,
            cardType: cardType, // 'yellow' or 'red'
            timestamp: Date.now()
        };
        
        team1Cards.push(cardData);
        
        // Aggiorna le statistiche
        if (cardType === 'yellow') {
            yellowCardsTeam1++;
            const statElement = document.getElementById('yellow-cards-team1');
            if (statElement) {
                statElement.classList.add('is-pulsing-stat');
                setTimeout(() => statElement.classList.remove('is-pulsing-stat'), 500);
            }
        } else if (cardType === 'red') {
            redCardsTeam1++;
            const statElement = document.getElementById('red-cards-team1');
            if (statElement) {
                statElement.classList.add('is-pulsing-stat');
                setTimeout(() => statElement.classList.remove('is-pulsing-stat'), 500);
            }
        }
        
        updateStats();
        updateCardsList();
        vibratePhone();
    }

    function addCardTeam2(cardType) {
        const team2Name = document.getElementById('team2-name').textContent;
        const cardData = {
            player: team2Name,
            cardType: cardType,
            timestamp: Date.now()
        };
        
        team2Cards.push(cardData);
        
        // Aggiorna le statistiche
        if (cardType === 'yellow') {
            yellowCardsTeam2++;
            const statElement = document.getElementById('yellow-cards-team2');
            if (statElement) {
                statElement.classList.add('is-pulsing-stat');
                setTimeout(() => statElement.classList.remove('is-pulsing-stat'), 500);
            }
        } else if (cardType === 'red') {
            redCardsTeam2++;
            const statElement = document.getElementById('red-cards-team2');
            if (statElement) {
                statElement.classList.add('is-pulsing-stat');
                setTimeout(() => statElement.classList.remove('is-pulsing-stat'), 500);
            }
        }
        
        updateStats();
        updateCardsList();
        vibratePhone();
    }

    // Update cards display function
    function updateCardsList() {
        // Update team 1 cards
        const cardsList1 = document.getElementById('cards-list-1');
        if (cardsList1) {
            cardsList1.innerHTML = '<h4>Cartellini:</h4>';
            team1Cards.forEach(card => {
                const cardDiv = document.createElement('div');
                cardDiv.classList.add('cards-list-item');
                
                const iconSrc = card.cardType === 'yellow' ? 
                    'icons8-cartellino-giallo-calcio-96.png' : 
                    'icons8-cartellino-rosso-calcio-96 (1).png';
                
                cardDiv.innerHTML = `
                    <img src="${iconSrc}" alt="${card.cardType} card">
                    ${card.player}
                `;
                cardsList1.appendChild(cardDiv);
            });
        }
        
        // Update team 2 cards
        const cardsList2 = document.getElementById('cards-list-2');
        if (cardsList2) {
            cardsList2.innerHTML = '<h4>Cartellini:</h4>';
            team2Cards.forEach(card => {
                const cardDiv = document.createElement('div');
                cardDiv.classList.add('cards-list-item');
                
                const iconSrc = card.cardType === 'yellow' ? 
                    'icons8-cartellino-giallo-calcio-96.png' : 
                    'icons8-cartellino-rosso-calcio-96 (1).png';
                
                cardDiv.innerHTML = `
                    <img src="${iconSrc}" alt="${card.cardType} card">
                `;
                cardsList2.appendChild(cardDiv);
            });
        }
    }
    
    // Funzione per resettare il gioco e mostrare il popup iniziale
    function resetGame() {
        // Resetta tutti i dati del gioco
        scoreTeam1 = 0;
        scoreTeam2 = 0;
        shotsTeam1 = 0;
        cornersTeam1 = 0;
        shotsTeam2 = 0;
        cornersTeam2 = 0;
        team1Scorers = [];
        team2Scorers = [];
        team1Cards = [];
        team2Cards = [];

        // Aggiorna le visualizzazioni
        updateScores();
        updateStats();

        // Cancella le liste dei marcatori e cartellini
        scorersList1.innerHTML = '<h4>Marcatori:</h4>';
        scorersList2.innerHTML = '<h4>Marcatori:</h4>';
        updateCardsList();
        
        // Reset notes field
        const notesElement = document.getElementById('match-notes');
        if (notesElement) {
            notesElement.value = '';
        }

        // Resetta il nome della squadra 2
        team2NameElement.textContent = 'Squadra 2';
        statsTeam2Title.textContent = 'Statistiche Squadra 2';
        scoreTeam2NameDisplay.textContent = 'Squadra 2';
        teamNameInput.value = ''; // Pulisci l'input

        // Resetta il timer
        resetTimer();

        hideResetModal();
        shareSection.classList.remove('is-visible');

        // Mostra il popup iniziale
        initialSetupModal.classList.add('is-active');
    }

    // Funzione per salvare la partita nello storico
    function saveMatch() {
        const team1Name = 'POLIS';
        const team2Name = team2NameElement.textContent;
        const notesElement = document.getElementById('match-notes');
        const notes = notesElement ? notesElement.value.trim() : '';
        const history = loadMatchHistory();

        const match = {
            team1: team1Name,
            team2: team2Name,
            score1: scoreTeam1,
            score2: scoreTeam2,
            shots1: shotsTeam1,
            corners1: cornersTeam1,
            shots2: shotsTeam2,
            corners2: cornersTeam2,
            date: new Date().toISOString(), // Salva la data in formato ISO per l'ordinamento
            scorers1: team1Scorers,
            scorers2: team2Scorers,
            notes: notes
        };
        history.push(match);
        localStorage.setItem('polis_match_history', JSON.stringify(history));
    }

    // Funzione per caricare lo storico da localStorage
    function loadMatchHistory() {
        const historyString = localStorage.getItem('polis_match_history');
        return historyString ? JSON.parse(historyString) : [];
    }

    // Funzione per eliminare una singola partita dallo storico
    function deleteMatch(index) {
        let history = loadMatchHistory();
        history.splice(index, 1);
        localStorage.setItem('polis_match_history', JSON.stringify(history));
        renderHistory();
    }

    // Funzione per eliminare tutto lo storico
    function clearMatchHistory() {
        localStorage.removeItem('polis_match_history');
        renderHistory();
    }
    
    // Funzione per renderizzare lo storico nel popup
    function renderHistory() {
        const history = loadMatchHistory().sort((a, b) => new Date(b.date) - new Date(a.date));
        historyList.innerHTML = '';
        
        // Update total matches played
        const totalMatchesElement = document.getElementById('total-matches-played');
        if (totalMatchesElement) {
            totalMatchesElement.textContent = history.length;
        }
        
        // Calcola risultati partite (vinte, perse, pareggiate)
        let matchesWon = 0, matchesLost = 0, matchesDrawn = 0;
        history.forEach(match => {
            const score1 = match.score1 || 0; // gol fatti da POLIS
            const score2 = match.score2 || 0; // gol subiti da POLIS
            
            if (score1 > score2) {
                matchesWon++;
            } else if (score1 < score2) {
                matchesLost++;
            } else {
                matchesDrawn++;
            }
        });
        
        // Aggiorna i totali dei risultati
        document.getElementById('total-matches-won').textContent = matchesWon;
        document.getElementById('total-matches-lost').textContent = matchesLost;
        document.getElementById('total-matches-drawn').textContent = matchesDrawn;
        
        // Calcola le statistiche generali e la classifica marcatori
        const allScorers = {};
        history.forEach(match => {
            if (match.scorers1 && Array.isArray(match.scorers1)) {
                match.scorers1.forEach(scorer => {
                    if (scorer.player) {
                        if (!allScorers[scorer.player]) {
                            allScorers[scorer.player] = 0;
                        }
                        allScorers[scorer.player]++;
                    }
                });
            }
        });
        
        // Ordina i marcatori per numero di gol
        const sortedScorers = Object.entries(allScorers).sort(([, a], [, b]) => b - a);

        // Calcola le statistiche totali per il riepilogo
        let totalGoalsMade = 0, totalGoalsConceded = 0;
        let totalShotsMade = 0, totalShotsConceded = 0;
        let totalCornersMade = 0, totalCornersConceded = 0;

        history.forEach(match => {
            // POLIS è sempre team1, quindi:
            totalGoalsMade += match.score1 || 0;        // gol fatti da POLIS
            totalGoalsConceded += match.score2 || 0;    // gol subiti da POLIS
            totalShotsMade += match.shots1 || 0;        // tiri fatti da POLIS  
            totalShotsConceded += match.shots2 || 0;    // tiri subiti da POLIS
            totalCornersMade += match.corners1 || 0;    // corner fatti da POLIS
            totalCornersConceded += match.corners2 || 0; // corner subiti da POLIS
        });

        // Aggiorna le statistiche del riepilogo
        document.getElementById('total-goals-made').textContent = totalGoalsMade;
        document.getElementById('total-goals-conceded').textContent = totalGoalsConceded;
        document.getElementById('total-shots-made').textContent = totalShotsMade;
        document.getElementById('total-shots-conceded').textContent = totalShotsConceded;
        document.getElementById('total-corners-made').textContent = totalCornersMade;
        document.getElementById('total-corners-conceded').textContent = totalCornersConceded;

        // Renderizza la classifica marcatori
        scorersTableBody.innerHTML = '';
        if (sortedScorers.length > 0) {
            sortedScorers.forEach(([player, goals], index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${player}</td>
                    <td>${goals}</td>
                `;
                scorersTableBody.appendChild(row);
            });
        } else {
            scorersTableBody.innerHTML = '<tr><td colspan="3" class="text-center text-gray-400">Nessun marcatore.</td></tr>';
        }

        // Renderizza la lista delle partite
        if (history.length === 0) {
            historyList.innerHTML = '<li class="text-center text-gray-400">Nessuna partita salvata.</li>';
        } else {
            history.forEach((match, index) => {
                const historyItem = document.createElement('li');
                historyItem.classList.add('history-item');
                const formattedDate = new Date(match.date).toLocaleDateString('it-IT', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                
                const team1ScorersText = match.scorers1.length > 0 ? `<br><span>Marcatori POLIS: ${match.scorers1.map(s => `${s.player} (${s.quarter})`).join(', ')}</span>` : '';
                const team2ScorersText = match.scorers2.length > 0 ? `<br><span>Marcatori ${match.team2}: ${match.scorers2.map(s => `Goal (${s.quarter})`).join(', ')}</span>` : '';
                const notesText = match.notes && match.notes.trim() ? `<br><span class="font-semibold text-yellow-300">Note: ${match.notes}</span>` : '';

                historyItem.innerHTML = `
                    <div class="history-item-header">
                        <div class="history-score-info">
                            <div class="font-bold">${match.team1} vs ${match.team2}</div>
                            <div class="text-xl font-bold">${match.score1} - ${match.score2}</div>
                        </div>
                        <button class="delete-btn" data-index="${index}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                    <div class="history-date">${formattedDate}</div>
                    <div class="mt-2 text-sm text-gray-300">
                        <div class="flex justify-between items-center">
                            <span>Tiri in porta:</span>
                            <span class="font-bold">${match.shots1} - ${match.shots2}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span>Corner:</span>
                            <span class="font-bold">${match.corners1} - ${match.corners2}</span>
                        </div>
                        ${team1ScorersText}
                        ${team2ScorersText}
                        ${notesText}
                    </div>
                `;
                historyList.appendChild(historyItem);
            });

            // Aggiungi listener ai nuovi pulsanti di eliminazione
            historyList.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.currentTarget.dataset.index);
                    showDeleteHistoryModal(index);
                });
            });
        }
    }

    // Funzioni per il timer
    function updateTimerDisplay() {
        let displayMinutes, displaySeconds, formattedTime;
        
        if (isInRecovery) {
            // In recovery time: show 00:00 + recovery time
            timerDisplay.textContent = "00:00";
            
            // Show recovery time
            const recoveryMinutes = Math.floor(recoverySeconds / 60);
            const recoverySecondsDisplay = recoverySeconds % 60;
            const recoveryFormattedTime = `${recoveryMinutes}:${recoverySecondsDisplay.toString().padStart(2, '0')}`;
            recoveryDisplay.textContent = `Recupero: ${recoveryFormattedTime}`;
            recoveryDisplay.style.display = 'inline';
        } else {
            // Normal time: show countdown
            displayMinutes = Math.floor(totalSeconds / 60);
            displaySeconds = totalSeconds % 60;
            formattedTime = `${displayMinutes.toString().padStart(2, '0')}:${displaySeconds.toString().padStart(2, '0')}`;
            timerDisplay.textContent = formattedTime;
            
            // Hide recovery display
            recoveryDisplay.style.display = 'none';
        }

        // Check if we need to transition to recovery time
        if (totalSeconds <= 0 && !isInRecovery) {
            isInRecovery = true;
            recoverySeconds = 0;
            
            // Play sound and vibrate when entering recovery
            vibratePhone(); 
            playTimerSound(); 
            
            // Don't stop the timer, continue running for recovery time
            // The timer will keep running and increment recoverySeconds
        }
    }

    function startTimer() {
        if (isRunning) return;
        isRunning = true;
        timerDisplay.classList.add('timer-running'); // Aggiunge l'animazione
        timerInterval = setInterval(() => {
            if (isInRecovery) {
                // In recovery time: increment recovery seconds
                recoverySeconds++;
            } else {
                // Normal time: decrement total seconds
                totalSeconds--;
            }
            updateTimerDisplay();
        }, 1000);
    }

    function pauseTimer() {
        if (!isRunning) return;
        isRunning = false;
        clearInterval(timerInterval);
        timerDisplay.classList.remove('timer-running'); // Rimuove l'animazione
    }

    function resetTimer() {
        pauseTimer();
        totalSeconds = lastSetSeconds;
        recoverySeconds = 0;
        isInRecovery = false;
        updateTimerDisplay();
    }
    
    // Funzioni per il popup del timer
    function showTimerSetupModal() {
        pauseTimer();
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        timerMinutesInput.value = minutes;
        timerSecondsInput.value = seconds;
        timerSetupModal.classList.add('is-active');
    }

    function hideTimerSetupModal() {
        timerSetupModal.classList.remove('is-active');
    }

    // Funzione per generare il contenuto HTML per la condivisione
    function generateShareContent() {
        const team1Name = 'POLIS';
        const team2Name = team2NameElement.textContent;
        const scorers1 = team1Scorers.map(s => `${s.player} (${s.quarter})`);
        const scorers2 = team2Scorers.map(s => `Goal (${s.quarter})`);
        const notesElement = document.getElementById('match-notes');
        const notes = notesElement ? notesElement.value.trim() : '';

        let content = `
            <p class="font-bold text-lg mb-2 text-center">${team1Name} vs ${team2Name}</p>
            <p class="share-score">${scoreTeam1} - ${scoreTeam2}</p>
            <div class="share-stat-item mb-1"><span>Tiri in porta:</span><span>${shotsTeam1} - ${shotsTeam2}</span></div>
            <div class="share-stat-item"><span>Corner:</span><span>${cornersTeam1} - ${cornersTeam2}</span></div>
        `;
        
        if (scorers1.length > 0) {
            content += `<div class="share-scorers"><h4>Marcatori ${team1Name}:</h4><p>${scorers1.join(', ')}</p></div>`;
        }
        if (scorers2.length > 0) {
            content += `<div class="share-scorers"><h4>Marcatori ${team2Name}:</h4><p>${scorers2.join(', ')}</p></div>`;
        }
        
        if (notes) {
            content += `<div class="share-scorers"><h4>Note:</h4><p>${notes}</p></div>`;
        }

        document.getElementById('share-summary-content').innerHTML = content;
    }

    // Funzione per catturare e visualizzare l'immagine
    function captureAndDisplay() {
        shareContentToCapture.style.display = 'block';
        html2canvas(shareContentToCapture, {
            backgroundColor: '#1e293b'
        }).then(canvas => {
            const imageData = canvas.toDataURL('image/png');
            screenshotPreview.src = imageData;
            downloadLink.href = imageData;
            screenshotPreview.classList.remove('hidden');
            shareContentToCapture.style.display = 'none';
        });
    }

    // Listener per il pulsante "Chiudi" della sezione di condivisione
    closeShareButton.addEventListener('click', () => {
        shareSection.classList.remove('is-visible');
    });

    // Aggiungi un listener di eventi a tutti i bottoni
    actionButtons.forEach(button => {
        button.addEventListener('click', (event) => {
            vibratePhone();
            const team = button.dataset.team;
            const type = button.dataset.type;
            const action = button.dataset.action;
            const quarter = button.dataset.quarter || '1°T'; // Default to 1°T if no quarter specified

            if (action === 'add') {
                if (type === 'goal') {
                    if (team === '1') {
                        showPlayerModal(quarter);
                    } else if (team === '2') {
                        addGoalTeam2(quarter);
                    }
                } else if (type === 'corner') {
                    if (team === '1') {
                        cornersTeam1++;
                        const statElement = document.getElementById('corners-team1');
                        statElement.classList.add('is-pulsing-stat');
                        setTimeout(() => statElement.classList.remove('is-pulsing-stat'), 500);
                    } else if (team === '2') {
                        cornersTeam2++;
                        const statElement = document.getElementById('corners-team2');
                        statElement.classList.add('is-pulsing-stat');
                        setTimeout(() => statElement.classList.remove('is-pulsing-stat'), 500);
                    }
                    updateStats();
                } else if (type === 'shot') {
                    if (team === '1') {
                        shotsTeam1++;
                        const statElement = document.getElementById('shots-team1');
                        statElement.classList.add('is-pulsing-stat');
                        setTimeout(() => statElement.classList.remove('is-pulsing-stat'), 500);
                    } else if (team === '2') {
                        shotsTeam2++;
                        const statElement = document.getElementById('shots-team2');
                        statElement.classList.add('is-pulsing-stat');
                        setTimeout(() => statElement.classList.remove('is-pulsing-stat'), 500);
                    }
                    updateStats();
                } else if (type === 'foul') {
                    if (team === '1') {
                        foulsTeam1++;
                        const statElement = document.getElementById('fouls-team1');
                        if (statElement) {
                            statElement.classList.add('is-pulsing-stat');
                            setTimeout(() => statElement.classList.remove('is-pulsing-stat'), 500);
                        }
                    } else if (team === '2') {
                        foulsTeam2++;
                        const statElement = document.getElementById('fouls-team2');
                        if (statElement) {
                            statElement.classList.add('is-pulsing-stat');
                            setTimeout(() => statElement.classList.remove('is-pulsing-stat'), 500);
                        }
                    }
                    updateStats();
                } else if (type === 'yellow-card') {
                    if (team === '1') {
                        showCardPlayerModal('yellow');
                    } else if (team === '2') {
                        addCardTeam2('yellow');
                    }
                } else if (type === 'red-card') {
                    if (team === '1') {
                        showCardPlayerModal('red');
                    } else if (team === '2') {
                        addCardTeam2('red');
                    }
                }
            } else if (action === 'remove') {
                showRemoveModal(type, team);
            }
        });
    });

    // Aggiungi listener per i pulsanti del popup di conferma rimozione
    confirmRemoveButton.addEventListener('click', () => {
        vibratePhone();
        const { type, team } = pendingRemovalAction;
        if (team === '1') {
            if (type === 'goal' && scoreTeam1 > 0) {
                scoreTeam1--;
                team1Scorers.pop(); // Rimuovi l'ultimo marcatore
                renderScorers(1);
            } else if (type === 'corner' && cornersTeam1 > 0) {
                cornersTeam1--;
            } else if (type === 'shot' && shotsTeam1 > 0) {
                shotsTeam1--;
            } else if (type === 'foul' && foulsTeam1 > 0) {
                foulsTeam1--;
            } else if (type === 'yellow-card' && yellowCardsTeam1 > 0) {
                yellowCardsTeam1--;
                // Remove last yellow card from team1Cards
                for (let i = team1Cards.length - 1; i >= 0; i--) {
                    if (team1Cards[i].cardType === 'yellow') {
                        team1Cards.splice(i, 1);
                        break;
                    }
                }
                updateCardsList();
            } else if (type === 'red-card' && redCardsTeam1 > 0) {
                redCardsTeam1--;
                // Remove last red card from team1Cards
                for (let i = team1Cards.length - 1; i >= 0; i--) {
                    if (team1Cards[i].cardType === 'red') {
                        team1Cards.splice(i, 1);
                        break;
                    }
                }
                updateCardsList();
            }
        } else if (team === '2') {
            if (type === 'goal' && scoreTeam2 > 0) {
                scoreTeam2--;
                team2Scorers.pop(); // Rimuovi l'ultimo marcatore
                renderScorers(2);
            } else if (type === 'corner' && cornersTeam2 > 0) {
                cornersTeam2--;
            } else if (type === 'shot' && shotsTeam2 > 0) {
                shotsTeam2--;
            } else if (type === 'foul' && foulsTeam2 > 0) {
                foulsTeam2--;
            } else if (type === 'yellow-card' && yellowCardsTeam2 > 0) {
                yellowCardsTeam2--;
                // Remove last yellow card from team2Cards
                for (let i = team2Cards.length - 1; i >= 0; i--) {
                    if (team2Cards[i].cardType === 'yellow') {
                        team2Cards.splice(i, 1);
                        break;
                    }
                }
                updateCardsList();
            } else if (type === 'red-card' && redCardsTeam2 > 0) {
                redCardsTeam2--;
                // Remove last red card from team2Cards
                for (let i = team2Cards.length - 1; i >= 0; i--) {
                    if (team2Cards[i].cardType === 'red') {
                        team2Cards.splice(i, 1);
                        break;
                    }
                }
                updateCardsList();
            }
        }
        updateScores();
        updateStats();
        hideRemoveModal();
    });
    
    // Funzione per renderizzare la lista dei marcatori
    function renderScorers(team) {
        if (team === 1) {
            scorersList1.innerHTML = '<h4>Marcatori:</h4>';
            team1Scorers.forEach(s => {
                const newScorer = document.createElement('div');
                newScorer.classList.add('scorer-list-item');
                newScorer.textContent = `${s.player} (${s.quarter})`;
                scorersList1.appendChild(newScorer);
            });
        } else if (team === 2) {
            scorersList2.innerHTML = '<h4>Marcatori:</h4>';
            team2Scorers.forEach(s => {
                const newScorer = document.createElement('div');
                newScorer.classList.add('scorer-list-item');
                newScorer.textContent = `Goal (${s.quarter})`;
                scorersList2.appendChild(newScorer);
            });
        }
    }
    
    cancelRemoveButton.addEventListener('click', () => {
        vibratePhone();
        hideRemoveModal();
    });

    // Aggiungi un listener di eventi al pulsante di reset per mostrare il popup
    resetButton.addEventListener('click', () => {
        vibratePhone();
        showResetModal();
    });
    
    // Aggiungi listener per i pulsanti del popup di conferma
    confirmResetButton.addEventListener('click', () => {
        vibratePhone();
        resetGame();
    });
    cancelResetButton.addEventListener('click', () => {
        vibratePhone();
        hideResetModal();
    });

    // Aggiungi listener per il nuovo pulsante "Annulla" del popup dei giocatori
    cancelPlayerSelectionButton.addEventListener('click', () => {
        vibratePhone();
        hidePlayerModal();
    });

    // Aggiungi un listener per il pulsante Salva e Condividi
    saveShareButton.addEventListener('click', () => {
        vibratePhone();
        saveMatch();
        generateShareContent();
        shareSection.classList.add('is-visible');
        setTimeout(() => {
            captureAndDisplay();
        }, 100);
    });

    // Listener per il pulsante "Chiudi" della sezione di condivisione
    closeShareButton.addEventListener('click', () => {
        shareSection.classList.remove('is-visible');
    });

    // Listener per il pulsante "Visualizza Storico"
    showHistoryButton.addEventListener('click', () => {
        vibratePhone();
        showHistoryModal();
    });

    // Listener per il pulsante "Chiudi" dello storico
    closeHistoryButton.addEventListener('click', () => {
        vibratePhone();
        hideHistoryModal();
    });

    // Listener per il pulsante di conferma eliminazione singola
    confirmDeleteHistoryButton.addEventListener('click', () => {
        vibratePhone();
        if (pendingDeletionIndex !== null) {
            deleteMatch(pendingDeletionIndex);
        }
        hideDeleteHistoryModal();
    });

    // Listener per il pulsante di annullamento eliminazione singola
    cancelDeleteHistoryButton.addEventListener('click', () => {
        vibratePhone();
        hideDeleteHistoryModal();
    });

    // Listener per il pulsante di conferma eliminazione completa
    confirmClearHistoryButton.addEventListener('click', () => {
        vibratePhone();
        clearMatchHistory();
        hideClearHistoryModal();
    });

    // Listener per il pulsante di annullamento eliminazione completa
    cancelClearHistoryButton.addEventListener('click', () => {
        vibratePhone();
        hideClearHistoryModal();
    });

    // Funzioni per il timer
    timerDisplay.addEventListener('click', showTimerSetupModal);
    startTimerButton.addEventListener('click', startTimer);
    pauseTimerButton.addEventListener('click', pauseTimer);
    resetTimerButton.addEventListener('click', resetTimer);
    setTimerButton.addEventListener('click', () => {
        const minutes = parseInt(timerMinutesInput.value);
        const seconds = parseInt(timerSecondsInput.value);
        if (!isNaN(minutes) && !isNaN(seconds)) {
            totalSeconds = (minutes * 60) + seconds;
            lastSetSeconds = totalSeconds;
            updateTimerDisplay();
            hideTimerSetupModal();
        }
    });
    
    // Listener per il pulsante "Inizia Partita"
    startGameButton.addEventListener('click', () => {
        const teamName = teamNameInput.value.trim();
        if (teamName !== '') {
            team2NameElement.textContent = teamName.toUpperCase();
            statsTeam2Title.textContent = 'Statistiche ' + teamName.toUpperCase();
            scoreTeam2NameDisplay.textContent = teamName.toUpperCase();
            initialSetupModal.classList.remove('is-active');
        } else {
            teamNameInput.focus();
        }
    });

    // Aggiungi un listener al pulsante "Cancella tutto" nello storico
    clearHistoryButton.addEventListener('click', showClearHistoryModal);

    // Preload audio on first user interaction
    document.addEventListener('click', () => {
        if (!fischioAudio) {
            fischioAudio = new Audio('./fischio.mp3');
        }
    });
    document.addEventListener('touchstart', () => {
        if (!fischioAudio) {
            fischioAudio = new Audio('./fischio.mp3');
        }
    });

    // Inizializza la visualizzazione del punteggio e la data
    updateScores();
    setDate();
    updateTimerDisplay(); // Inizializza il display del timer
</script>

</body>
</html>

